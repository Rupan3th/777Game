<%@ Page Language="C#" AutoEventWireup="true" CodeFile="main.aspx.cs" Inherits="_777Game_main" %>

<%@ Register Src="chat_room.ascx" TagName="chat_room" TagPrefix="uc2" %>
<%@ Register Src="~/777Game/chat_room.ascx" TagPrefix="uc1" TagName="chat_room" %>
<%@ Register src="chat6cn_room.ascx" tagname="chat6cn_room" tagprefix="uc3" %>

<!DOCTYPE html>

<html>
<head runat="server">
   <title>水果老虎机</title>
    <script src="../files/js/jquery-1.8.3.min.js"></script> 
    <script type="text/javascript" src="../files/js/fruit_slots.js"></script>

    <script type="text/javascript" src="../files/js/player.js"></script>
    <script type="text/javascript" src="../files/js/segment-display.js"></script>
    <script type="text/javascript" src="../files/js/jquery.jqGauges.min.js"></script>
    <script type="text/javascript" src="../files/js/jquery.mobile-1.4.5.js"></script>
    <script src="/files/js/jquery.cookie.js"></script>
    <script src="/files/js/common.js"></script>
    <link href="../files/css/common_n.css" rel="stylesheet" /> 
    <link rel="stylesheet" href="../files/css/industrial.css">
 
    <style type="text/css">
        *
        {
            font-size:12px;
            font-family:宋体;
            margin:0;
            padding:0;
        }

        .backimg {
            /*Login Page Background*/
            width: 1920px;
            height: 1080px;
            position: absolute;
            left: 50%;
            top: 50%;
            margin: -540px 0 0 -960px;                               
        }     

         body {
         margin-left: 0px;
         margin-top: 0px;
         margin-right: 0px;
         margin-bottom: 0px;
         overflow-y: hidden;
         overflow-x: hidden;
        }
    </style>

    <script>
        function detectmob() {
            if (navigator.userAgent.match(/Android/i)
            || navigator.userAgent.match(/webOS/i)
            || navigator.userAgent.match(/iPhone/i)
            || navigator.userAgent.match(/iPad/i)
            || navigator.userAgent.match(/iPod/i)
            || navigator.userAgent.match(/BlackBerry/i)
            || navigator.userAgent.match(/Windows Phone/i)
            ) {
                location.href = "/777Game/mobile/m_main.aspx";
            }
        }
        detectmob();

        var user_id = '<%= Session["user_id"] %>';
        var username = '<%= Session["User"] %>';
        var usercoin = '<%= Session["coin"] %>';
        usercoin = usercoin + 1 - 1;
        var zhibo_id = '<%= Session["zhibo_id"] %>';
        zhibo_id = parseInt(zhibo_id);
        zhibo_id = 15;
        var room = 1;

        PostAjax("/Ajax/loginstate.ashx", "category=2&user_id=" + user_id + "&loginfir=" + 1);
        setInterval(function () {
           PostAjax("/Ajax/loginstate.ashx", "category=2&user_id=" + user_id);
        }, 5 * 60 * 1000);

        PostAjax("/Ajax/tvroom_manager.ashx", "user_id=" + user_id + "&room=" + room + "&state=0");
        $(window).on("beforeunload", function () {
            PostAjax("/Ajax/tvroom_manager.ashx", "user_id=" + user_id + "&room=" + room + "&state=1");
            return "Buy now!!!";
        });
                           
        ///streamplayer drag move
        var img_L = 0;
        var img_T = 0;
        var targetObj;

        function getLeft(o) {
            return parseInt(o.style.left.replace('px', ''));
        }
        function getTop(o) {
            return parseInt(o.style.top.replace('px', ''));
        }

        // 이미지 움직이기
        function moveDrag(e) {
            var e_obj = window.event ? window.event : e;
            var dmvx = parseInt(e_obj.clientX + img_L);
            var dmvy = parseInt(e_obj.clientY + img_T);
            targetObj.style.left = dmvx + "px";
            targetObj.style.top = dmvy + "px";
            document.getElementById("livestreaming").style.left = dmvx + "px";
            document.getElementById("livestreaming").style.top = dmvy + "px";
            return false;
        }

        // 드래그 시작
        function startDrag(e, obj) {
            targetObj = obj;
            var e_obj = window.event ? window.event : e;
            img_L = getLeft(obj) - e_obj.clientX;
            img_T = getTop(obj) - e_obj.clientY;

            document.onmousemove = moveDrag;
            document.onmouseup = stopDrag;
            if (e_obj.preventDefault) e_obj.preventDefault();
        }

        // 드래그 멈추기
        function stopDrag() {
            document.onmousemove = null;
            document.onmouseup = null;
        }

        function doubleSize(e, obj) {
            var width_D = parseInt(obj.style.width) *2;
            var height_ifr = parseInt(document.getElementById("livestreaming").style.height) * 2;
            var height_D = height_ifr - 40;
            if (width_D > 888)
            {
                width_D = 222;
                height_D = 200
                obj.style.left = 595 + "px";
                obj.style.top = 202 + "px";
                document.getElementById("livestreaming").style.left = 595 + "px";
                document.getElementById("livestreaming").style.top = 202 + "px";
            }
            obj.style.width = width_D + "px";
            obj.style.height = height_D + "px";
            document.getElementById("livestreaming").style.width = width_D + "px";
            document.getElementById("livestreaming").style.height = height_ifr + "px";

            var ifra = document.getElementById('livestreaming').contentWindow;
            ifra.resize();
        }

     
    </script>       
   
</head>

<body style="background-color:saddlebrown; margin: 0 0 0 0; ">
    <audio id="bgsound" src="/files/audio/bg.mp3" autoplay="autoplay" ></audio>
    <div id="div_back" class="backimg">
        <form id="form1" runat="server">        
            <div id="play" class="game_main"></div>

            <div id="slot_machine_log" style="width:75px; height:560px; position: absolute; left:240px; top:201px; ">
                <!--left log area-->
                <ul id='slot_log' class='slot_log' style="width:75px; height:560px; overflow-y:hidden"></ul>                
            </div>

            <div id="dice_log1" style="width:75px; height:560px; position: absolute; left:1107px; top:205px; ">
                <!--dice log area-->
                <ul id='diceTai_log' class='diceTai_log' style="width:75px; height:560px; overflow-y:hidden"></ul>
            </div>
            <div id="dice_log2" style="width:75px; height:560px; position: absolute; left:1182px; top:205px; ">
                <!--dice log area-->
                <ul id='diceodd_log' class='diceodd_log' style="width:75px; height:560px; overflow-y:hidden"></ul>
            </div>

            <div id="chat_area" style="width:419px; height:752px; position: absolute; left:1275px; top:75px">
                <div id="total_log_area" style="width:419px; height:208px">
                    <!--top total log area-->
                    <ul id='total_log' class='total_log' style="color:blue; width:400px; height:188px; margin:11px; margin-left:20px; overflow-y:hidden"></ul>
                </div>
                <div id="live_chat_area" style="width:395px; height:544px;margin-left:10px">
                    <!--chat area-->
                    <uc3:chat6cn_room ID="chat6cn_room1" runat="server" />
                </div>
            </div>

            <iframe id="livestreaming"  src="wowza_live.aspx" style="border:0px; width:222px; height:232px; position:absolute;left:595px;top:202px; z-index:103; overflow-y:hidden; overflow-x:hidden" ></iframe>     
            <div id="bubble" style="border:solid; width:222px; height:200px; position:absolute;left:595px;top:202px; opacity:0; z-index:103;" onmousedown="startDrag(event, this)" ondblclick="doubleSize(event, this)" ></div> 
            
        </form>
    </div>
        <script>
            document.getElementById('bgsound').loop = true;
            document.getElementById('bgsound').play();
            
            function onResize() {
                var w = 1920, tmpw;
                var h = 1080, tmph;
                var mw = '-960px';
                var mh = '-540px';

                var val = window.document.getElementById("div_back");

                //set margin by current layout. if this code no excute, page broken when resize browser.
                mw = val.clientWidth / 2; mw = "-" + mw + 'px';
                mh = val.clientHeight / 2; mh = "-" + mh + 'px';

                //If height too long or less long(when zoom)
                tmph = Math.min(h, self.innerHeight);
                if (val.clientHeight > self.innerHeight || (h >= tmph && tmph > val.clientHeight)) {
                    document.getElementById('div_back').style.height = tmph + 'px';
                    mh = tmph / 2;
                    mh = "-" + mh + 'px';
                }

                //If width too long or less long(when zoom)
                tmpw = Math.min(w, self.innerWidth);
                if (val.clientWidth > self.innerWidth || (w >= tmpw && tmpw > val.clientWidth)) {
                    document.getElementById('div_back').style.width = tmpw + 'px';
                    mw = tmpw / 2;
                    mw = "-" + mw + 'px';
                }

                //re layout by margin
                document.getElementById('div_back').style.margin = mh + ' 0 0 ' + mw;
            }
            window.onresize = onResize;
            onResize();
        </script>
</body>
</html>

<script type="text/javascript">
    window.onload = function() {
        var g = new wLaoHuJi("play");
        g.init();
    }

    var msg = PostAjax("/Ajax/spinlog.ashx", "");    
    var myArray = new Array(7);
    myArray = msg.split('/');
    var semi = new Array(3);
    for (var i = 0; i < 7; i++) {
        semi = myArray[i].split(',');
        var cssfruit = slotlogcss[semi[0] - 1];
        var text = "<div style='width:75px;height:80px' class='" + cssfruit + "'></div>"
        if (text.length) {
            $('<li />', { html: text }).appendTo('ul.slot_log')
        }
        //$("#slot_log").scrollTop($("#slot_log")[0].scrollHeight);

        var csstaisai = taisailogcss[semi[1]];
        var text = "<div style='width:75px;height:80px' class='" + csstaisai + "'></div>"
        if (text.length) {
            $('<li />', { html: text }).appendTo('ul.diceTai_log')
        }
       // $("#diceTai_log").scrollTop($("#diceTai_log")[0].scrollHeight);

        var cssevodd = evoddlogcss[semi[2]];
        var text = "<div style='width:75px;height:80px' class='" + cssevodd + "'></div>"
        if (text.length) {
            $('<li />', { html: text }).appendTo('ul.diceodd_log')
        }
        //$("#diceodd_log").scrollTop($("#diceodd_log")[0].scrollHeight);
    }
</script>
